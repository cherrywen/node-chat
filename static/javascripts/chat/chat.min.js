function changeChatPerson(e){var s=_.findWhere(users,{id:e}),a="all"==e?"":"talk to ";a+=s.name,$("#chatName").html(a),$(".chatForm").attr("id",s.id),$("#chatInformation").html("").append(chatInfos[s.id])}var socket=io.connect("/"),users=[],chatInfos=[];$(function(){function e(){var e=new Date,s=e.getFullYear(),a=10>e.getMonth()+1?"0"+(e.getMonth()+1):e.getMonth()+1,t=10>e.getDate()?"0"+e.getDate():e.getDate(),n=10>e.getHours()?"0"+e.getHours():e.getHours(),o=10>e.getMinutes()?"0"+e.getMinutes():e.getMinutes(),c=10>e.getSeconds()?"0"+e.getSeconds():e.getSeconds();return s+"-"+a+"-"+t+" "+n+":"+o+":"+c}mainObj=$("body");var s=$("#showUsers"),a=null;$(".setUser").click(function(){var e=$("#userName").val();e?(dataObj={name:e},socket.emit("login",dataObj),$(".loginForm").hide(),$(".fade").hide(),$(".userName").val("")):alert("昵称不能为空！！!")}),$("#sendMsg").click(function(){var s=$("#chatMsg").val();if(s){var t=$(".chatForm").attr("id"),n={userId:a.id,receiveUserId:t,name:a.name,msg:s,time:e()};"all"==$(".chatForm").attr("id")?socket.emit("sendMessage",n):_.findWhere(users,{id:t})?socket.emit("sendToOne",n):alert("该用户已下线，无法向其发送消息"),$("#chatMsg").val("")}else alert("内容不能为空！！！")}),socket.on("user",function(e){a=e,socket.on(a.id,function(e){var s=chatInfos[e.userId]?chatInfos[e.userId]:"";s+='<div><span class="chatUser">'+e.name+"@"+e.time+' : </span><span class="chatMessage">'+e.msg+"</span></div>",chatInfos[e.userId]=s,$(".chatForm").attr("id")==e.userId&&$("#chatInformation").html("").append(s)})}),socket.on("users",function(e){users=e;var a="";_.each(users,function(e){a+='<div class="showUsers" onclick="changeChatPerson(\''+e.id+"')\">"+e.name+"</div>"}),s.html("").append(a)}),socket.on("sendMessage",function(e){var s=chatInfos.all?chatInfos.all:"";s+='<div><span class="chatUser">'+e.name+"@"+e.time+' : </span><span class="chatMessage">'+e.msg+"</span></div>",chatInfos.all=s,$("#chatInformation").html("").append(s)}),socket.on("sendToOne",function(e){var s=chatInfos[e.receiveUserId]?chatInfos[e.receiveUserId]:"";s+='<div><span class="chatUser">'+e.name+"@"+e.time+' : </span><span class="chatMessage">'+e.msg+"</span></div>",chatInfos[e.receiveUserId]=s,$("#chatInformation").html("").append(s)})});