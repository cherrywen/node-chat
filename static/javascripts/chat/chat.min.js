function changeChatPerson(e){var t=_.findWhere(users,{id:e}),s="all"==e?"":"talk to ";s+=t.name,$("#chatName").html(s),$(".chatForm").attr("id",t.id),$("#chatInformation").html(chatInfos[t.id]||""),$("#chatMsg").focus()}function keywordsMsg(e){var t=e||window.event;13==t.keyCode&&$("#sendMsg").click()}function keywordsUserName(e){var t=e||window.event;13==t.keyCode&&$(".setUser").click()}var socket=io.connect("/"),users=[],chatInfos=[];$(function(){function e(e,t){a=chatInfos[e]?chatInfos[e]:"",a+='<div><span class="chatUser">'+t.name+"@"+t.time+' : </span><span class="chatMessage">'+t.msg+"</span></div>",chatInfos[e]=a,(e==t.receiveUserId||$(".chatForm").attr("id")==e)&&$("#chatInformation").html(a)}function t(){var e=new Date,t=e.getFullYear(),s=10>e.getMonth()+1?"0"+(e.getMonth()+1):e.getMonth()+1,n=10>e.getDate()?"0"+e.getDate():e.getDate(),a=10>e.getHours()?"0"+e.getHours():e.getHours(),o=10>e.getMinutes()?"0"+e.getMinutes():e.getMinutes(),c=10>e.getSeconds()?"0"+e.getSeconds():e.getSeconds();return t+"-"+s+"-"+n+" "+a+":"+o+":"+c}$("body");var s=$("#showUsers"),n=null,a=null;$("#userName").focus(),$(".setUser").click(function(){var e=$("#userName").val();e?(dataObj={name:e},socket.emit("login",dataObj),$(".loginForm").hide(),$(".fade").hide(),$(".userName").val(""),$("#chatMsg").focus()):alert("昵称不能为空！！！")}),$("#sendMsg").click(function(){var e=$("#chatMsg").val();if(e){var s=$(".chatForm").attr("id"),a={userId:n.id,receiveUserId:s,name:n.name,msg:e,time:t()};"all"==$(".chatForm").attr("id")?socket.emit("sendMessage",a):_.findWhere(users,{id:s})?socket.emit("sendToOne",a):alert("该用户已下线，无法向其发送消息"),$("#chatMsg").val("")}else alert("内容不能为空！！！")}),socket.on("user",function(t){n=t,socket.on(n.id,function(t){e(t.userId,t)})}),socket.on("users",function(e){users=e;var t="";_.each(users,function(e){t+='<div class="showUsers" onclick="changeChatPerson(\''+e.id+"')\">"+e.name+"</div>"}),s.html(t)}),socket.on("sendMessage",function(t){e("all",t)}),socket.on("sendToOne",function(t){e(t.receiveUserId,t)})});